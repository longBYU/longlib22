C
	INTEGER FUNCTION IPCLP3(V1,V2)
C
C	CLIPS A 3D LINE FROM V1 TO V2 TO A VIEWING PYRAMID
C
C	RETURN CODE:	-1	INVISIBLE LINE
C			 0	FULLY VISIBLE LINE
C			 1	CLIPPED FIRST POINT OFF
C			 2	CLIPPED SECOND POINT OFF
C			 3	CLIPPED BOTH ENDS OFF
C
	DIMENSION V1(4),V2(4)
	INTEGER CLIP3D,B1,B2,B,IPC
C
	B1=CLIP3D(V1(1),V1(2),V1(3))
	B2=CLIP3D(V2(1),V2(2),V2(3))
	IPC=0
100	IF (IOR(B1,B2).NE.0) THEN
		IF (IAND(B1,B2).NE.0) THEN	! INVISIBLE LINE
			IPC=-1
			GOTO 1000
		ENDIF
		B=B1
		IF (B.EQ.0) B=B2
		IF (IAND(B,1).NE.0) THEN	! CLIP LEFT
			T=(V1(3)+V1(1))/((V1(1)-V2(1))-(V2(3)-V1(3)))
			Z=T*(V2(3)-V1(3))+V1(3)
			X=-Z
			Y=T*(V2(2)-V1(2))+V1(2)
		ENDIF
		IF (IAND(B,2).NE.0) THEN	! CLIP RIGHT
			T=(V1(3)-V1(1))/((V2(1)-V1(1))-(V2(3)-V1(3)))
			Z=T*(V2(3)-V1(3))+V1(3)
			X=Z
			Y=T*(V2(2)-V1(2))+V1(2)
		ENDIF
		IF (IAND(B,4).NE.0) THEN	! CLIP BOTTOM
			T=(V1(3)+V1(2))/((V1(2)-V2(2))-(V2(3)-V1(3)))
			Z=T*(V2(3)-V1(3))+V1(3)
			X=T*(V2(1)-V1(1))+V1(1)
			Y=-Z
		ENDIF
		IF (IAND(B,8).NE.0) THEN	! CLIP TOP
			T=(V1(3)-V1(2))/((V2(2)-V1(2))-(V2(3)-V1(3)))
			Z=T*(V2(3)-V1(3))+V1(3)
			X=T*(V2(1)-V1(1))+V1(1)
			Y=Z
		ENDIF
		IF (B.EQ.B1) THEN
			IPC=IPC+1
			V1(1)=X
			V1(2)=Y
			V1(3)=Z
			B1=CLIP3D(X,Y,Z)
		ELSE
			IPC=IPC+2
			V2(1)=X
			V2(2)=Y
			V2(3)=Z
			B2=CLIP3D(X,Y,Z)
		ENDIF
		GOTO 100
	ENDIF
1000	IPCLP3=IPC
	RETURN
	END
