c
	FUNCTION ICTERM(IX)
C
C	SIMILAR TO CTERM BUT RETURNS USER OPTIONS TO PROGRAM FOR ICTERM(2)
C
C	FORTRAN-77 VERSION:   DGL JUNE 1990
C
C	CONTROLS A GRAPHICS TERMINAL
C
C	NOTE: NOT ALL OPTIONS ARE AVAILABLE IN ALL GRAPHICS DEVICES.
C
C IX	CONTROL FLAG
C	= 0 PUT TERMINAL IN GRAPHICS MODE, CLEAR TERMINAL SCREEN
C	= 1 RETURN TERMINAL TO TERMINAL MODE
C	=-1 RETURN TERMINAL TO GRAPHICS MODE
C	= 2 RETURN TERMINAL TO TERMINAL MODE, ASK IF GRAPHICS SCREEN CLEAR
C	=-2 RETURN TERMINAL TO TERMINAL MODE, CLEAR SCREEN
C	= 3 CLEAR TERMINAL SCREEN, LEAVE IN GRAPHICS MODE
C	=-3 CLEAR GRAPHICS SCREEN, LEAVE IN GRAPHICS MODE
C	= 4 DUMP GRAPHICS SCREEN TO PRINTER, LEAVE IN GRAPHICS
C	=-4 CLEAR TERMINAL AND GRAPHICS SCREEN, LEAVE IN GRAPHICS MODE
C	= 5 TURN OFF GRAPHICS SCREEN, RETURN TO TERMINAL MODE
C	=-5 TURN ON GRAPHICS SCREEN, RETURN TO GRAPHICS MODE
C	= 6 TOGGLE REVERSE VIDEO, LEAVE IN GRAPHICS
C	= 8 RESTORE TERMINAL TO ANSI MODE
C
C	FOR SELNAR EQUIPPED VT100, VT220 AND VT125, CTERM SWITCHES BACK AND
C	FORTH BETWEEN THE TERMINAL MODE AND GRAPHICS MODE.  THE VT240 CLEARS
C	THE SCREEN EACH TIME THIS IS DONE SO THIS EFFECT IS INHIBITED.  FOR THE
C	VT240, CTERM ONLY SWITCHES IT INTO THE TEK 4010 MODE AND LEAVES IT
C	THERE UNTIL THE (8) CALL WHEN PLOTND IS CALLED.
C
C	TERMINALS WHICH DO NOT HAVE THE TEXT AND GRAPHICS ON SEPARATE
C	PLANES SET THE ALPHA CURSOR TO THE HOME POSITION BEFORE RETURNING
C	TO "TEXT" POSITION.
C
	COMMON/VT100/IVT100,IMV(32),VRE(2),VOX,VOY,VSF,NIMV,VANG,ITERM,
     $		VVP(4),MV,MVW,IVCOL,IXLIM,IYLIM,IYREV,VLIM(2),IMODE
	SAVE /VT100/,ITOG
C
C	ESCAPE SEQUENCES REQUIRED TO CONTROL TERMINAL/GRAPHICS MODE
C	DIMENSIONED: ACTION(#CHARACTERS+1,#OF DEVICES)
C		#DEVICES = 6, #CHARACTERS=7
C	NOTE: LAST CHARACTER CONTAINS NUMBER OF CHARS IN COMMAND ACTIONS:
C	"VTERM" PUTS TERMINAL IN TERMINAL MODE
C	"GTERM" PUTS TERMINAL IN GRAPHICS MODE
C	"VCLEAR" CLEARS TERMINAL MODE SCREEN
C	"GCLEAR" CLEARS GRAPHICS MODE SCREEN
C
 	CHARACTER*1 ANS
	INTEGER ESC, HOME(6)
C
	INTEGER VTERM(7,8),GTERM(7,8),VCLER(7,8),GCLER(7,8)
	INTEGER SG10VT(7), SG10GT(7), SG10VC(7), SG10GC(7) ! SELNAR GR100 TEK MODE
	INTEGER VT12VT(7), VT12GT(7), VT12VC(7), VT12GC(7)  ! VT125+RETRO
	INTEGER VT24VT(7), VT24GT(7), VT24VC(7), VT24GC(7)  ! VT240 4010 MODE
	INTEGER VT22VT(7), VT22GT(7), VT22VC(7), VT22GC(7)  ! VT220 SG100
	INTEGER T401VT(7), T401GT(7), T401VC(7), T401GC(7)  ! TEK 4010
	INTEGER T410VT(7), T410GT(7), T410VC(7), T410GC(7)  ! TEK 4107
	INTEGER GO23VT(7), GO23GT(7), GO23VC(7), GO23GC(7)  ! GRAPHON GO-235
	INTEGER XTVT(7), XTGT(7), XTVC(7), XTGC(7)  ! XTERM
C
	EQUIVALENCE (VTERM(1,1), SG10VT),(GTERM(1,1), SG10GT),
     $		    (VCLER(1,1), SG10VC),(GCLER(1,1), SG10GC)
	EQUIVALENCE (VTERM(1,2), VT12VT),(GTERM(1,2), VT12GT),
     $		    (VCLER(1,2), VT12VC),(GCLER(1,2), VT12GC)
	EQUIVALENCE (VTERM(1,3), VT24VT),(GTERM(1,3), VT24GT),
     $		    (VCLER(1,3), VT24VC),(GCLER(1,3), VT24GC)
	EQUIVALENCE (VTERM(1,4), VT22VT),(GTERM(1,4), VT22GT),
     $		    (VCLER(1,4), VT22VC),(GCLER(1,4), VT22GC)
	EQUIVALENCE (VTERM(1,5), T401VT),(GTERM(1,5), T401GT),
     $		    (VCLER(1,5), T401VC),(GCLER(1,5), T401GC)
	EQUIVALENCE (VTERM(1,6), T410VT),(GTERM(1,6), T410GT),
     $		    (VCLER(1,6), T410VC),(GCLER(1,6), T410GC)
	EQUIVALENCE (VTERM(1,7), GO23VT),(GTERM(1,7), GO23GT),
     $		    (VCLER(1,7), GO23VC),(GCLER(1,7), GO23GC)
	EQUIVALENCE (VTERM(1,8), XTVT),(GTERM(1,8), XTGT),
     $		    (VCLER(1,8), XTVC),(GCLER(1,8), XTGC)
C
	DATA SG10VT/27,50,0,0,0,0,2/		! <ESC>2      SELNAR GR100 IN
	DATA SG10GT/27,49,27,42,0,0,4/		! <ESC>1<ESC>* TEK 4010 MODE
	DATA SG10VC/27,91,50,74,0,0,4/		! <ESC>[2J
	DATA SG10GC/27,42,27,12,0,0,4/		! <ESC>*<ESC><FF>
C
	DATA VT12VT/24,0,0,0,0,0,1/		! <CAN>(^X) VT125 (VT100+RETRO)
	DATA VT12GT/29,0,0,0,0,0,1/		! <GS> (^])
	DATA VT12VC/27,91,50,74,0,0,4/		! <ESC>[2J
	DATA VT12GC/27,12,0,0,0,0,2/		! <ESC><FF>
C
	DATA VT24VT/27,91,63,51,56,108,0/	! <ESC>[?38l  VT240 7 BIT 
	DATA VT24GT/27,91,63,51,56,104,0/	! <ESC>[?38h	CONTROLS
	DATA VT24VC/27,91,50,74,0,0,0/		! <ESC>[2J
	DATA VT24GC/27,12,0,0,0,0,2/		! <ESC><FF>
C
	DATA VT22VT/27,50,27,91,52,105,6/	! <ESC>2<ESC>[4i  VT220 (SG220)
	DATA VT22GT/27,91,53,105,27,49,6/	! <ESC>[5i<ESC>1  
	DATA VT22VC/27,91,50,74,0,0,4/		! <ESC>[2J
	DATA VT22GC/27,12,0,0,0,0,2/		! <ESC><FF>
C
	DATA T401VT/0,0,0,0,0,0,0/		! Tek 4010/4014
	DATA T401GT/0,0,0,0,0,0,0/		! 
	DATA T401VC/27,12,0,0,0,0,2/		! <ESC><FF>
	DATA T401GC/27,12,0,0,0,0,2/		! <ESC><FF>
C
	DATA T410VT/0,0,0,0,0,0,0/		! Tek 4107/4109
	DATA T410GT/0,0,0,0,0,0,0/		!
	DATA T410VC/27,76,90,0,0,0,3/		! <ESC>LZ (DIALOG CLEAR)
	DATA T410GC/27,12,0,0,0,0,2/		! <ESC><FF>
C
	DATA GO23VT/24,0,0,0,0,0,1/		! <CAN>  GRAPHON GO-235
	DATA GO23GT/29,0,0,0,0,0,1/		! <GS>
	DATA GO23VC/27,91,50,74,0,0,4/		! <ESC>[2J
	DATA GO23GC/27,97,27,12,0,0,4/		! <ESC>a<ESC><FF>
C
	DATA XTVT/27,3,0,0,0,0,2/		! <ESC><ETX> XTERM
	DATA XTGT/27,91,63,51,56,104,7/		! <ESC>[?38h
	DATA XTVC/27,91,50,74,0,0,4/		! <ESC>[2J
	DATA XTGC/27,12,0,0,0,0,2/		! <ESC><FF>
C
	DATA ITOG/0/			! SCREEN TOGGLE FLAG
C
	DATA ESC/27/			! ASCII ESCAPE
	DATA HOME/29,63,111,32,64,31/	! CURSOR IN VT100 UL POSITION
	data ISKIP/0/
C       
	ICTERM=0
	IF (IVT100.EQ.-99.AND.IX.EQ.2) GOTO 80	! SPECIAL SKIP PLOTTING IN EFFECT
	IF (IVT100.LE.0) RETURN			! TERMINAL NOT IN USE
	IF (IABS(IX).GT.8) RETURN		! INVALID OPTION
C
C	OPTION SWITCH
C
1	FORMAT('+',6A1,$)
	GOTO (60,30,100,120,20,85,70,10,40,80,15,130,110,30,50,180),IX+8
99	RETURN
C
10	CONTINUE				! INIT GR SCREEN, CLEAR TERMINAL SCREEN ONLY
	IF (ITERM.EQ.6) THEN
C						! TEK4107 ANSI MODE CLEAR SCREEN
		WRITE(*,1) CHAR(ESC),CHAR(91),CHAR(50),CHAR(74)
C						! TEK4107 TO TEK MODE
		WRITE(*,1) CHAR(ESC),CHAR(37),CHAR(33),CHAR(48)
	ENDIF
	WRITE(*,1) (CHAR(VTERM(I,ITERM)),I=1,VTERM(7,ITERM))
	WRITE(*,1) (CHAR(VCLER(I,ITERM)),I=1,VCLER(7,ITERM))
	WRITE(*,1) (CHAR(GTERM(I,ITERM)),I=1,GTERM(7,ITERM))
	WRITE(*,1) (CHAR(GCLER(I,ITERM)),I=1,GCLER(7,ITERM))
	IMODE=1				! GRAPHICS MODE
	GOTO 99
15	CONTINUE			! CLEAR TERMINAL SCREEN, GR MODE
	WRITE(*,1) (CHAR(VTERM(I,ITERM)),I=1,VTERM(7,ITERM))
	WRITE(*,1) (CHAR(VCLER(I,ITERM)),I=1,VCLER(7,ITERM))
	WRITE(*,1) (CHAR(GTERM(I,ITERM)),I=1,GTERM(7,ITERM))
	IF (ITERM.EQ.4) WRITE(*,1) (CHAR(GTERM(I,ITERM)),I=1,6)	! VT240
	IMODE=1				! GRAPHICS MODE
	GOTO 99
20	CONTINUE			! CLEAR GRAPHICS SCREEN, GR MODE
	IF (ITERM.EQ.4) WRITE(*,1) (CHAR(GTERM(I,ITERM)),I=1,6)	! VT240
	WRITE(*,1) (CHAR(GTERM(I,ITERM)),I=1,GTERM(7,ITERM))
	WRITE(*,1) (CHAR(GCLER(I,ITERM)),I=1,GCLER(7,ITERM))
	IMODE=1				! GRAPHICS MODE
	GOTO 99
30	CONTINUE				! TOGGLE VIDEO SCREEN
C							! SELNARS
	IF (ITERM.EQ.1) WRITE(*,1) CHAR(ESC),CHAR(48),CHAR(ESC),CHAR(40)
C							! GRAPHON
	IF (ITERM.EQ.7) WRITE(*,1) CHAR(ESC),CHAR(91),CHAR(49+ITOG),
     $				   CHAR(35),CHAR(122)
	ITOG=ITOG+1
	IF (ITOG.GE.2) ITOG=1
	GOTO 99
40	CONTINUE				! TERMINAL MODE
	WRITE(*,1) (CHAR(GTERM(I,ITERM)),I=1,GTERM(7,ITERM))
	WRITE(*,1) (CHAR(HOME(I)),I=1,6)
	WRITE(*,1) (CHAR(VTERM(I,ITERM)),I=1,VTERM(7,ITERM))
	IMODE=0				! TERMINAL MODE
	GOTO 99
50	CONTINUE
60	CONTINUE
	GOTO 99
70	CONTINUE				! GRAPHICS MODE
	WRITE(*,1) (CHAR(GTERM(I,ITERM)),I=1,GTERM(7,ITERM))
	IMODE=1				! GRAPHICS MODE
	GOTO 99
80	CONTINUE				! CLEAR SCREEN PROMPT
	IF (IVT100.EQ.-99) THEN		! MULTIPLE PASS SKIPPING
		ISKIP=ISKIP-1
		IF (ISKIP.GT.0) GOTO 99
	ELSE
		ISKIP=0
	ENDIF
	WRITE(*,1) (CHAR(GTERM(I,ITERM)),I=1,GTERM(7,ITERM))
CC	WRITE(*,1) (CHAR(HOME(I)),I=1,6)
	WRITE(*,1) (CHAR(VTERM(I,ITERM)),I=1,VTERM(7,ITERM))
	IMODE=0				! TERMINAL MODE
505	WRITE(*,5)
5	FORMAT(' Clear Screen Option? (y,n,q,s,d,e) [y] ',$)
	READ(*,6,END=9000) ANS
6	FORMAT(A1)
C
C	CONVERT INPUT CHARACTER TO UPPER CASE ANSII
C
	IANS=ICHAR(ANS)
	IF (IANS.GE.96) IANS=IANS-32
C
C	QUESTION MARK REPLY
C
	IF (IANS.EQ.63) THEN
		WRITE(*,84)
84		FORMAT(/' Y : Clear screen [default]'/' n : No clear '/
     $		' q : Quit (disable screen plotting)'/
     $		' s : Skip screen plotting until next "cterm(2)"'/
     $		' p : Skip screen plotting until specified "cterm(2)"'/
     $		' d : Dump screen to terminal printer'/
     $		' e : User exit code'/)
		GOTO 505
	ENDIF
C
C	Y OR NO REPLY
C
	IF (IANS.EQ.89.OR.IANS.EQ.32) THEN
		IVT100=1			! ONLY WHEN IVT100=-99
		GOTO 85
	ELSE
		IF (IANS.EQ.81) IVT100=-1	! TURN OFF VT100 PLOTTING
		IF (IANS.EQ.83) THEN		! SKIP PLOTTING
			IVT100=-99  
			ISKIP=0
		ENDIF
		IF (IANS.EQ.68) GOTO 130	! DUMP TO PRINTER
		IF (IANS.EQ.69) THEN		! USER EXIT
			ICTERM=1
		ENDIF
		IF (IANS.EQ.80) THEN		! PASS SKIP
			IVT100=-99  
			WRITE(*,86)
86			FORMAT(' Number of CTERM(2)s to skip? ',$)
			READ(*,*) ISKIP
		ENDIF
	ENDIF
	GOTO 99
C
 85	CONTINUE		! CLEAR BOTH SCREENS
	WRITE(*,1) (CHAR(VCLER(I,ITERM)),I=1,VCLER(7,ITERM))
	WRITE(*,1) (CHAR(GTERM(I,ITERM)),I=1,GTERM(7,ITERM))
	WRITE(*,1) (CHAR(GCLER(I,ITERM)),I=1,GCLER(7,ITERM))
	WRITE(*,1) (CHAR(VTERM(I,ITERM)),I=1,VTERM(7,ITERM))
	WRITE(*,1) (CHAR(VCLER(I,ITERM)),I=1,VCLER(7,ITERM))
	GOTO 99
C
9000	CONTINUE		! END OF INPUT FILE
	ICTERM=-1
	RETURN
c90	CONTINUE				! TERMINAL SCREEN CLEAR, T MODE
c	WRITE(*,1) (CHAR(GTERM(I,ITERM)),I=1,GTERM(7,ITERM))
c	WRITE(*,1) (CHAR(HOME(I)),I=1,6)
c	WRITE(*,1) (CHAR(VTERM(I,ITERM)),I=1,VTERM(7,ITERM))
c	WRITE(*,1) (CHAR(VCLER(I,ITERM)),I=1,VCLER(7,ITERM))
c	IMODE=0				! TERMINAL MODE
c	GOTO 99
100	CONTINUE				! TURN GR SCREEN OFF
	WRITE(*,1) (CHAR(GTERM(I,ITERM)),I=1,GTERM(7,ITERM))
	IF (ITERM.EQ.1) WRITE(*,1) CHAR(ESC),CHAR(39)	! SELNARS (')
	IF (ITERM.EQ.7) WRITE(*,1) CHAR(ESC),CHAR(91),CHAR(48),
     $				   CHAR(35),CHAR(122)	! GRAPHON
	WRITE(*,1) (CHAR(VTERM(I,ITERM)),I=1,VTERM(7,ITERM))
	IMODE=0				! TERMINAL MODE
	GOTO 99
110	CONTINUE				! TURN GR SCREEN ON
	WRITE(*,1) (CHAR(GTERM(I,ITERM)),I=1,GTERM(7,ITERM))
	IF (ITERM.EQ.1) WRITE(*,1) CHAR(ESC),CHAR(34)	! SELNARS (")
	IF (ITERM.EQ.7) WRITE(*,1) CHAR(ESC),CHAR(91),CHAR(50),
     $				   CHAR(35),CHAR(122)	! GRAPHON
	IMODE=1				! GRAPHICS MODE
	GOTO 99
120	CONTINUE				! CLEAR BOTH SCREENS
	WRITE(*,1) (CHAR(GTERM(I,ITERM)),I=1,GTERM(7,ITERM))
	WRITE(*,1) (CHAR(GCLER(I,ITERM)),I=1,GCLER(7,ITERM))
	WRITE(*,1) (CHAR(VTERM(I,ITERM)),I=1,VTERM(7,ITERM))
	WRITE(*,1) (CHAR(VCLER(I,ITERM)),I=1,VCLER(7,ITERM))
	IMODE=0				! TERMINAL MODE
	GOTO 99
130	CONTINUE				! DUMP GRAPHICS TO PRINTER
	WRITE(*,1) (CHAR(GTERM(I,ITERM)),I=1,GTERM(7,ITERM))
CC	IF (ITERM.EQ.1) WRITE(*,1) CHAR(ESC),CHAR(59),CHAR(ESC),CHAR(58)! SELNARS
	WRITE(*,1) CHAR(ESC),CHAR(23) ! VT125,VT240,VT220,AND TEKS
	IMODE=1				! GRAPHICS MODE
	GOTO 99
180	CONTINUE			! DE-INITIALIZE GRAPHICS TERMINAL
C
C	COMMAND SEQUENCES TO RESTORE TERMINAL TO NOMINAL OPERATION MODE
C
	WRITE(*,1) (CHAR(VTERM(I,ITERM)),I=1, VTERM(7,ITERM))
	IMODE=0				! TERMINAL MODE
	IF (ITERM.EQ.3) WRITE(*,1) (CHAR(VTERM(I,ITERM)),I=1,6)	! VT240
C					! SELECT ANSI MODE FOR TEK4107
	IF (ITERM.EQ.6) WRITE(*,1) CHAR(ESC),CHAR(37),CHAR(33),CHAR(49)
	GOTO 99
	END
